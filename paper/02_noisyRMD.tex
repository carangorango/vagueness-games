\section{Replicator diffusion dynamic}

The replicator diffusion dynamic (\rdd) was first introduced by
\citet{Correia2013:The-Bivalent-Tr} as a noise-perturbed variant of
the replicator dynamic (\rd) in behavioral strategies. We begin by
recapitulating the formulation of the \rd in behavioral
strategies. Then we define the replicator diffusion dynamics in
behavioral strategies, following \citet{Correia2013:The-Bivalent-Tr}.
Finally we show that the \rdd is a special case of the \rmd.

\subsection{Replicator dynamic in behavioral strategies}

Fix a signaling game with states $\States$, messages $\Messgs$ and
acts $\Acts$. Let $\Pr(\cdot) \in \Delta{\States}$ be the prior
distribution over states and $\Util_{\sen,\rec} \mycolon \States
\times \Messgs \times \Acts \rightarrow \mathds{R}$ the senders's and
receiver's utility functions. The sender's behavioral strategies are
functions $\Sstrat \in \Delta(\Messgs)^\States$; the receiver's are
functions $\Rstrat \in \Delta(\Acts)^\Messgs$. Define the expected
utility of actions in each choice point are defined as usual:
\begin{align*}
  \EU(\messg \myts ; \myts \state, \Rstrat) & = \sum_{\act \in \Acts}
  \Rstrat(\act \probbar \messg) \cdot U_\sen(\state, \messg, \act) \\
  \EU(\act \myts ; \myts \messg, \Sstrat) & = \sum_{\state \in
    \States} \Pr(\state) \cdot \Sstrat(\messg \probbar \state) \cdot
  U_\rec(\state, \messg, \act) \,.
\end{align*}
The \emph{fitness} of a behavioral strategy at a choice point is the
frequency-weighted average of expected utilities of each choice, given
the opponent's strategy:
\begin{align*}
  \Phi(\state,\Sstrat, \Rstrat) & = \sum_{\messg} \Sstrat(\messg \probbar \state) \cdot
\EU(\messg \myts ; \myts\state,\Rstrat) \\
\Phi(\messg,\Sstrat, \Rstrat) & = \sum_{\act} \Rstrat(\act \probbar \messg)
\cdot \EU(\act \myts ; \myts \messg,\Sstrat)\,.
\end{align*}
The discrete-time replicator dynamic maps current strategies $\Sstrat$
and $\Rstrat$ to future strategies $\RD(\Sstrat)$ and $\RD(\Rstrat)$ in
such a way that changes in frequency are proportional to expected
utilities. For behavioral strategies, the changes take place locally
at each of the agents' choice points:\todo{could be shortened by using
  $\propto$ notation}
\begin{align*}
  \RD(\Sstrat)(\messg \probbar \state_i) & = \frac{\Sstrat(\messg \probbar \state_j) \cdot
    \EU(\messg,\state_j,\Rstrat)} {\Phi(\state_j,\Sstrat, \Rstrat)} \\
    \RD(\Rstrat)(\state_i \probbar \messg) & = \frac{\Rstrat(\state_j \probbar \messg) \cdot
    \EU(\state_j,\messg,\Sstrat)} {\Phi(\messg,\Sstrat, \Rstrat)}  \,.
\end{align*}

\todo[inline]{example? sim-max game 10 states, after so and so many rounds?}

\subsection{Replicator diffusion dynamic in behavioral strategies}

The replicator diffusion dynamic adds probabilistic confusion of
similar states to the replicator dynamics. Fix a sim-max game with
$\States = \Acts$ and a confusion matrix $C$. $C$ is a row-stochastic
matrix whose elements $C_{ij}$ give the probability that $\state_i$ is
realized as $\state_j$. The confusability of states affects senders
and receivers alike, but in slightly different ways (see
Figure~\ref{fig:noise-perturbation-of-strategies}). For the sender,
$C_{ij}$ is the probability that the actual states \mystate{i} is
perceived as \mystate{j}. For the receiver, $C_{ij}$ is the
probability that \mystate{j} is the interpretation that is actually
formed when \mystate{i} is the output of the receiver's strategy.

\begin{figure}
  \centering

    \begin{tikzpicture}[node distance = 2cm, thick]

      \begin{scope}
  
      \node[rectangle, draw=mycol, fill=mycol!25, thick] (actual)
      {actual state $\mystate{i}$};

      \node[rectangle, draw=mycol, fill=mycol!25, thick, below of =
      actual] (perceived) {perceived state $\mystate{j}$};

      \node[rectangle, draw=mycol, fill=mycol!25, thick, below of =
      perceived] (output) {chosen message $\messg$};

      \node[rectangle, thick, below of = output, node distance=1cm]
      (sender) {sender};

      \draw[->] (actual) -> (perceived) node[midway,left] {noise
        $C_{ij}$};

      \draw[->] (perceived) -> (output) node[midway,left] (label)
      {strategy $\Sstrat(\messg \probbar \mystate{j})$};

   
      \begin{pgfonlayer}{background}
        \node [draw=black!50, fill=black!20,fit=(actual) (label)
        (output)] {};
      \end{pgfonlayer}
    \end{scope}


      \begin{scope}[xshift=5cm]
  
      \node[rectangle, draw=mycol, fill=mycol!25, thick] (message)
      {observed message $\messg$};

      \node[rectangle, draw=mycol, fill=mycol!25, thick, below of =
      message] (target) {target interpretation $\mystate{i}$};

      \node[rectangle, draw=mycol, fill=mycol!25, thick, below of =
      target] (realized) {realized interpretation $\mystate{j}$};

      \node[rectangle, thick, below of = realized, node distance=1cm]
      (sender) {receiver};

      \draw[->] (message) -> (target) node[midway,right] (bla) {strategy
        $\Rstrat(\mystate{i} \probbar \messg)$};

      \draw[->] (target) -> (realized) node[midway,right]  {noise $C_{ij}$};

   
      \begin{pgfonlayer}{background}
        \node [draw=black!50, fill=black!20,fit = (message) 
        (realized) (bla)] {};
      \end{pgfonlayer}
    \end{scope}

  \end{tikzpicture}

  \caption{Effect of confusion of states on sender and receiver
    choices.}
  \label{fig:noise-perturbation-of-strategies}
\end{figure}

The aggregate effect of confusion of states on behavioral strategies
can be captured in a function that maps behavioral strategies
$\Sstrat$ and $\Rstrat$ on their noise-perturbed realizations
$C(\Sstrat)$ and $C(\Rstrat)$. The idea is that $\Sstrat$ and
$\Rstrat$ are what, on average, the idealized, confusion-free behavior
would be, while $C(\Sstrat)$ and $C(\Rstrat)$ are behavioral
strategies that describe the agents' actual noise-perturbed
probabilistic behavior. If we conceive of behavioral strategies
$\Sstrat$ and $\Rstrat$ as row-stochastic matrices, the effect of
state confusability is easily captured by matrix multiplication as:
\begin{align*}
  C(\Sstrat) & = C \Sstrat &    C(\Rstrat) & = \Rstrat C\,.
\end{align*}

The discrete-time replicator diffusion dynamic takes the replicator
dynamic as basic, but factors in the confusion of states at each
update step in a sequential update:
\begin{align*}
  \RDD(\Sstrat) & = C(\RD(\Sstrat)) &   \RDD(\Rstrat) & = C(\RD(\Rstrat)) 
\end{align*}
This is equivalent to the following definition, given by
\citet{Correia2013:The-Bivalent-Tr}:
\begin{align*}
  \RDD(\Sstrat)(\messg \probbar \state_i) & = \sum_{j} C_{ij} \cdot
  \frac{\Sstrat(\messg \probbar \state_j) \cdot
    \EU(\messg,\state_j,\Rstrat)} {\Phi(\state_j,\Rstrat)} \\
    \RDD(\Rstrat)(\state_i \probbar \messg) & = \sum_{j} C_{ij} \cdot
  \frac{\Rstrat(\state_j \probbar \messg) \cdot
    \EU(\state_j,\messg,\Sstrat)} {\Phi(\messg,\Sstrat)}  \,.
\end{align*}

The idea behind the sequential definition of the \rdd is that, at each
time step, strategies are gradually optimized along the current
fitness landscape, as described by the \rd, but the realization of
optimized strategies is bound to be noisy, due to confusion of
states. It is obvious that other (discrete-time) evolutionary dynamics
can be subjected to state-confusability in an analogous fashion
\citep{Correia2013:The-Bivalent-Tr}. In the case of the \rd, however,
perturbation by state-confusion has a prominent close relative in the
replicator mutator dynamic.

\subsection{Relation with the replicator mutator dynamic}

The replicator mutator dynamic (\rmd) has been proposed by Martin
Nowak first in the context of signaling game models for the evolution
of grammar
\citep[e.g.][]{KomarovaNiyogi2001:The-Evolutionar,NowakKomarova2001:Evolution-of-Un,Nowak2006:Evolutionary-Dy}. The
relation of the \rmd to other prominent evolutionary dynamics is well
understood \citep{PageNowak2002:Unifying-Evolut}. The \rmd has seen
further fruitful applications in the context of signaling games
\citep{HutteggerSkyrms2010:Evolutionary-Dy}. It is therefore desirable
to relate the \rdd that we propose here to the \rmd.

A direct comparison between \rdd and the \rmd is not possible, because
the usual formulation of the latter is in its continuous-time form,
and based on mixed strategies, not behavioral strategies. We therefore
give a discrete-time formulation of the \rmd in behavioral strategies,
which is independently useful. The relation between \rdd and \rmd will
then be plain to see.

\subsubsection{Replicator mutator dynamic}

Pure sender (receiver) strategies are functions $\Spure \in
\Messgs^\States$ ($\Rpure \in \Acts^\Messgs$). Mixed sender (receiver)
strategies are functions $\Smixed \in \Delta(\Messgs^\States)$
($\Rmixed \in (\Acts^\Messgs)$). The latter give the relative
population frequencies of the former. We write $\Smixed_i$ for the
frequency $\Smixed(\Spure_i)$ of pure strategy $\Spure_i$ (also for
the receiver). For mixed strategies, we define the players' fitness in
the usual manner. Let $F_i^{\Rmixed}$ be $\Spure_i$'s fitness given
$\Rmixed$ and $F_i^{\Smixed}$ be $\Rpure_i$'s fitness given
$\Smixed$. Then $\Phi(\Smixed,\Rmixed) = \sum_{k} \Smixed_k \cdot
F_k^{\Rmixed}$ is the average fitness in the sender population and
$\Phi(\Rmixed,\Smixed) = \sum_{k} \Rmixed_k \cdot F_k^{\Smixed}$ the
average fitness in the receiver population.

Every mixed strategy $\Smixed$ converts to a unique behavioral
strategy defined by:
\begin{align*}
  \Sstrat(\messg \probbar \state) = \sum_{\Spure(\state) = \messg} \Smixed(\Spure)\,.
\end{align*} 
Let $G$ be this mapping from mixed to behavioral strategies. Notice
that $G$ is \emph{not} an injection, as many mixed strategies map onto
the same behavioral strategy. \todo{this should not be here}



\paragraph{Replicator dynamics in pure strategies.} The two-population
(non-payoff adjusted) continuous replicator dynamics in pure
strategies is defined as:
\begin{align*}
  \dot{\Smixed_i} & = \Smixed_i \cdot \left ( F_i^{\Rmixed} -
  \Phi(\Smixed,\Rmixed) \right ) &   \dot{\Rmixed_i} &  = \Rmixed_i \cdot \left ( F_i^{\Smixed} -
  \Phi(\Rmixed,\Smixed) \right ) \,.
\end{align*}
The discrete time version is given by: 
\begin{align*}
  \Smixed_i' & = \frac{\Smixed_i \cdot
  F_i^{\Rmixed}}{ \Phi(\Smixed,\Rmixed)} &     \Rmixed_i' & = \frac{\Rmixed_i \cdot
  F_i^{\Smixed}}{ \Phi(\Rmixed,\Smixed)} \,.
\end{align*}


\paragraph{Replicator-mutator equation.} Let $Q$ be a row-stochastic
mutation matrix where $Q_{ji}$ gives the probability that pure sender
strategy $\Spure_j$ mutates into $\Spure_i$. Similarly, let $R$ be a
row-stochastic mutation matrix where $R_{ji}$ gives the probability
that pure receiver strategy $\Rpure_j$ mutates into $\Rpure_i$.

The two-population (non-payoff adjusted) continuous replicator-mutator
dynamics, is then given by::
\begin{align*}
  \dot{\Smixed_i} & = \sum_{j}  Q_{ji} \cdot \Smixed_j
    \cdot F_j^{\Rmixed} - \Smixed_i \cdot \Phi(\Smixed,\Rmixed) &
    \dot{\Rmixed_i} & = \sum_{j}  R_{ji} \cdot \Rmixed_j
    \cdot F_j^{\Smixed} - \Rmixed_i \cdot \Phi(\Rmixed,\Smixed) \,.
\end{align*}
\begin{claim} A discrete time version of the above replicator mutator
  dynamics is:
  \begin{align*}
    \Smixed_i' & = \sum_{j} Q_{ji} \frac{\Smixed_j \cdot
      F_j^{\Rmixed}}{ \Phi(\Smixed,\Rmixed)} & \Rmixed_i' & = \sum_{j}
    R_{ji} \frac{\Rmixed_j \cdot F_j^{\Smixed}}{
      \Phi(\Rmixed,\Smixed)}\,.
  \end{align*}
\end{claim}

\begin{proof}
  It suffices to check either sender or receiver part. Focusing on the
  former, we need to show that the continuous version is derivable
  from the discrete version if the discrete update steps get
  infinitely small so that:
  \begin{align*}
    \dot{\Smixed_i} & = \Smixed_i' - \Smixed_i = \sum_{j} Q_{ji}
    \frac{\Smixed_j \cdot F_j^{\Rmixed}}{ \Phi(\Smixed,\Rmixed)} -
    \Smixed_i = \sum_{j} \Smixed_j \left ( \frac{ Q_{ji} \cdot
        F_j^{\Rmixed}}{ \Phi(\Smixed,\Rmixed)} - \Smixed_i \right ) \\
    & = \sum_{j} \Smixed_j \left ( \frac{ Q_{ji} \cdot
        F_j^{\Rmixed} - \Smixed_i \cdot \Phi(\Smixed,\Rmixed)}{ \Phi(\Smixed,\Rmixed)}  \right )
  \end{align*}
  As $\Phi(\Smixed,\Rmixed)$ is a constant rate of change, we can drop
  it to derive the non-payoff adjusted continuous version above,
  since:
  \begin{align*}
    & \sum_{j} \Smixed_j \left ( Q_{ji} \cdot
        F_j^{\Rmixed} - \Smixed_i \cdot \Phi(\Smixed,\Rmixed)  \right
      ) =     \sum_{j} \Smixed_j  Q_{ji} \cdot
        F_j^{\Rmixed} - \sum_{j} \Smixed_j \cdot \Smixed_i \cdot
        \Phi(\Smixed,\Rmixed) \\
       = &    \sum_{j} \Smixed_j  Q_{ji} \cdot
        F_j^{\Rmixed} - \Smixed_i \cdot
        \Phi(\Smixed,\Rmixed) 
  \end{align*}
\end{proof}

The discrete time replicator-mutator dynamics has a nice sequential
update property: first we compute the fitness-driven change according
to the standard replicator dynamics; then we compute the perturbation
from mutation.

\subsection{Noise-perturbed replicator dynamics}

We look at signaling games with $\States = \Acts$ and fix a confusion
matrix $C$, which is a row-stochastic matrix whose elements $C_{ij}$
give the probability that $\state_i$ is perceived as
$\state_j$. Define the players' average utility at each choice point given
the opponent's strategy as:
\begin{align*}
  \Phi(\state,\Rstrat) & = \sum_{\messg} \Sstrat(\messg \probbar \state) \cdot
\EU(\messg,\state,\Rstrat) &
\Phi(\messg,\Sstrat) & = \sum_{\state} \Rstrat(\state \probbar \messg)
\cdot \EU(\state,\messg,\Sstrat)\,.
\end{align*}
The discrete noise-perturbed replicator dynamics on behavioral
strategies proposed by \citet{Correia2013:The-Bivalent-Tr} is:
\begin{align*}
  \Sstrat'(\messg \probbar \state_i) & = \sum_{j} C_{ji} \cdot
  \frac{\Sstrat(\messg \probbar \state_j) \cdot
    \EU(\messg,\state_j,\Rstrat)} {\Phi(\state_j,\Rstrat)} \\
    \Rstrat'(\state_i \probbar \messg) & = \sum_{j} C_{ji} \cdot
  \frac{\Rstrat(\state_j \probbar \messg) \cdot
    \EU(\state_j,\messg,\Sstrat)} {\Phi(\messg,\Sstrat)}  \,.
\end{align*}
Notice that this update is also sequential: first we calculate an
update according to the standard replicator dynamics (in behavioral
strategies), then we compute the perturbation from perceptual noise.


\subsection{Exploring the relation}

We will show that the noise-perturbed replicator dynamics defined
above is the behavioral-strategy analogue to the replicator-mutator
dynamics when the only source of mutation is perceptual confusion of
states. Since, in general, the replicator dynamics in two-populations
is not equivalent in its formulations for behavioral and mixed
strategies \citep{Cressman2003:Evolutionary-Dy}, we abstract from the
dynamics and look only at the effect of mutation and
noise-perturbation. This is justified given the above mentioned
sequential nature of both dynamics.

Let the mutation $Q(\Smixed)$ ($R(\Rmixed)$) of a mixed sender
(receiver) strategy be another mixed sender (receiver) strategy
defined by:
\begin{align*}
  Q(\Smixed)_i & =  \sum_j  \Smixed_j \cdot
  Q_{ji} &   R(\Rmixed)_i & =  \sum_{j}  \Rmixed_j \cdot
  R_{ji} \,.
\end{align*}
We would like to compare this to the noise perturbation $C(\Sstrat)$
($C(\Rstrat)$) of behavioral strategy $\Sstrat$ ($\Rstrat)$, which is
another behavioral strategy given by:
\begin{align*}
  C(\Sstrat)(\messg \probbar \state_i) & = \sum_{j} C_{ji} \cdot
  \Sstrat(\messg \probbar \state_j) & C(\Rstrat)(\state_i \probbar
  \messg) & = \sum_{j} C_{ji} \cdot \Rstrat(\state_j \probbar \messg)
  \,.
\end{align*}

We hypothesize that a confusion matrix $C$ should give rise to a
unique mutation matrix $Q^C$ so that whenever $G(\Smixed) = \Sstrat$
we also have $G(Q^C(\Smixed)) = C(\Sstrat)$. Similarly, for the
receiver.

\paragraph{Confusion-based mutations.} There are natural conversions
of $C$ into $Q^C$ and $R^C$. The case for the receiver is easier, so
we start with that.

The probability that $\Rpure$ mutates into $\Rpure'$ is the product of
the probabilities for each $\messg$ that $\Rpure(\messg)$ is perceived
as $\Rpure'(\messg)$. Abusing notation, by refer to the index of
$\Rpure(\messg)$ and $\Rpure'(\messg)$ with $\Rpure(\messg)$ and
$\Rpure'(\messg)$ directly, we define:
\begin{align*}
  R^C_{ji} = \prod_{\messg} C_{\Rpure(\messg)\Rpure'(\messg)}\,.
\end{align*}

Now look at the sender. If $\Spure_j(\state_k)=\messg$ and
$\Spure_i(\state_k)=\messg'$, then the probability of confusion at
state $\state_k$ is given by the chance that $\state_k$ is perceived
as a state $\state_l$ which $\Spure_j$ would map onto $\messg'$. The
overal probability that $\Spure_j$ mutates into $\Sstrat_i$ is the
product of these chances for all states. So, define:
\begin{align*}
  Q^C_{ji} = \prod_{\state_k} \sum_{\state_l \in
    \Spure_j^{-1}(\Spure_i(\state_k))} C_{kl}\,.
\end{align*}

For example, consider a signaling game with two states and two
messages. Let the confusion matrix be:
\begin{align*}
  C=
  \begin{pmatrix}
    .8 & .2 \\
    .2 & .8 
  \end{pmatrix}\,.
\end{align*}
The resulting mutation matrices are:
\begin{align*}
S^C & = \bordermatrix{ ~ & 11 & 12 & 21 & 22 \cr
                      11 & 1 & 0 & 0 & 0 \cr
                      12 & .16 & .64 & .04 & .16 \cr
                      21 & .16 & .04 & .64 & .16 \cr
                      22 & 0 & 0 & 0 & 1 \cr}
&                    
  R^C & = \bordermatrix{ ~ & 11 & 12 & 21 & 22 \cr
                      11 & .64 & .16 & .16 & .04 \cr
                      12 & .16 & .64 & .04 & .16 \cr
                      21 & .16 & .04 & .64 & .16 \cr
                      22 & .04 & .12 & .12 & .64 \cr}\,.
\end{align*}
Here, a pair like $21$, for example, refers to a pure sender strategy
with $\Spure(\state_1=\messg_2$ and $\Spure(\state_2) =
\messg_1$. Similarly for the receiver.

\medskip

\todo[inline]{necessary to prove that mutation matrices are row-stochastic?}

\todo[inline]{maybe worthwhile to think about general properties of
  the mutation matrices that ensue from perceptual confusion?}

\medskip

\begin{theorem}
  \label{thm:sender-eq}
  If $G(\Smixed) = \Sstrat$, then $G(Q^C(\Smixed)) = C(\Sstrat)$.
\end{theorem}


\begin{theorem}
  \label{thm:receiver-eq}
  If $G(\Rmixed) = \Rstrat$, then $G(R^C(\Rmixed)) = C(\Rstrat)$.
\end{theorem}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "paper"
%%% TeX-PDF-mode: t
%%% End:



